{
	"resourceType": "TestScript",
	"id": "connectathon-15-patient-base-client-id-json",
	"url": "http://wildfhir.aegis.net/fhir3-0-0/TestScript/connectathon-15-patient-base-client-id-json",
	"name": "FHIR Connectathon 15 - Patient - JSON - Client Assigned Resource Id",
	"status": "active",
	"date": "2017-03-13",
	"publisher": "AEGIS.net, Inc.",
	"contact": [
		{
			"name": "Touchstone Support",
			"telecom": [
				{
					"system": "email",
					"value": "Touchstone_Support@aegis.net",
					"use": "work"
				}
			]
		}
	],
	"description": "Baseline tests using the JSON format to create, update, retrieve history and search a patient without extensions where the client assigns the resource id. The destination server must support conditional create.",
	"copyright": "Â© AEGIS.net, Inc. 2015+",
	"metadata": {
		"capability": [
			{
				"required": true,
				"description": "Patient read, update, delete, history-instance and search-type operations",
				"link": [
					"http://hl7.org/fhir/STU3/http.html#read",
					"http://hl7.org/fhir/STU3/http.html#update",
					"http://hl7.org/fhir/STU3/http.html#delete",
					"http://hl7.org/fhir/STU3/http.html#history",
					"http://hl7.org/fhir/STU3/http.html#search",
					"http://hl7.org/fhir/STU3/patient.html"
				]
			}
		]
	},
	"fixture": [
		{
			"id": "patient-create-PeterChalmers",
			"resource": {
				"reference": "../_reference/resources/patient-create-client-id-PeterChalmers.json"
			}
		},
		{
			"id": "patient-create-PeterChalmers-min",
			"resource": {
				"reference": "../_reference/resources/patient-create-PeterChalmers-min.json"
			}
		},
		{
			"id": "patient-update-PeterChalmers",
			"resource": {
				"reference": "../_reference/resources/patient-update-PeterChalmers.json"
			}
		},
		{
			"id": "patient-update-PeterChalmers-min",
			"resource": {
				"reference": "../_reference/resources/patient-update-PeterChalmers-min.json"
			}
		}
	],
	"profile": [
		{
			"id": "bundle-profile",
			"reference": "http://hl7.org/fhir/StructureDefinition/Bundle"
		},
		{
			"id": "patient-profile",
			"reference": "http://hl7.org/fhir/StructureDefinition/Patient"
		}
	],
	"variable": [
		{
			"name": "createResourceId",
			"path": "Patient/id",
			"sourceId": "patient-read-PeterChalmers"
		},
		{
			"name": "createIdentifier",
			"path": "Patient/identifier/value",
			"sourceId": "patient-create-PeterChalmers"
		},
		{
			"name": "searchFamilyName",
			"path": "Patient/name/family",
			"sourceId": "patient-create-PeterChalmers"
		},
		{
			"name": "searchGivenName",
			"path": "Patient/name/given",
			"sourceId": "patient-create-PeterChalmers"
		}
	],
	"setup": {
		"action": [
			{
				"operation": {
					"type": {
						"system": "http://hl7.org/fhir/testscript-operation-codes",
						"code": "delete"
					},
					"resource": "Patient",
					"description": "System-generated search and delete operations from conditional delete to insure the patient does not exist on the server.",
					"accept": "json",
					"contentType": "json",
					"params": "?given=${searchGivenName}&family=${searchFamilyName}"
				}
			}
		]
	},
	"test": [
		{
			"id": "Step1-RegisterNewPatient",
			"name": "RegisterNewPatient",
			"description": "Create a new patient, no extensions where the client assigns the resource id using JSON.",
			"action": [
				{
					"operation": {
						"type": {
							"system": "http://hl7.org/fhir/testscript-operation-codes",
							"code": "updateCreate"
						},
						"resource": "Patient",
						"description": "Create patient with client assigned resource id.",
						"accept": "json",
						"contentType": "json",
						"params": "/${createIdentifier}",
						"responseId": "create-response",
						"sourceId": "patient-create-PeterChalmers"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP status is 200(OK) or 201(Created).",
						"operator": "in",
						"responseCode": "200,201"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned format is JSON.. Warning only as the server may not support the return of response content.",
						"contentType": "json",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP Header Last-Modified is present. Warning only as the server may not support versioning.",
						"headerField": "Last-Modified",
						"operator": "notEmpty",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP Header ETag is present. Warning only as the server may not support versioning.",
						"headerField": "ETag",
						"operator": "notEmpty",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP Header Location is present. Warning only as this is optional but servers are encouraged to return this.",
						"headerField": "Location",
						"operator": "notEmpty",
						"warningOnly": true
					}
				},
				{
					"operation": {
						"type": {
							"system": "http://hl7.org/fhir/testscript-operation-codes",
							"code": "read"
						},
						"resource": "Patient",
						"description": "Read using params element",
						"accept": "json",
						"contentType": "json",
						"params": "/${createIdentifier}",
						"responseId": "patient-read-PeterChalmers"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP status is 200(OK).",
						"response": "okay"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned format is JSON.",
						"contentType": "json"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned resource type is Patient.",
						"resource": "Patient"
					}
				},
				{
					"assert": {
						"description": "Validate that the returned resource conforms to the base FHIR Patient profile.",
						"validateProfileId": "patient-profile"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned resource contains the expected retained elements and values. Warning only to provide users with reviewable results.",
						"minimumId": "patient-create-PeterChalmers-min",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Confirm that the resource version is present. Warning only as the server may not support versioning.",
						"operator": "notEmpty",
						"path": "Patient/meta/versionId",
						"warningOnly": true
					}
				}
			]
		},
		{
			"id": "Step2-UpdatePatient",
			"name": "Step2-UpdatePatient",
			"description": "Update the patient's birth date, no extensions.",
			"action": [
				{
					"operation": {
						"type": {
							"system": "http://hl7.org/fhir/testscript-operation-codes",
							"code": "update"
						},
						"resource": "Patient",
						"accept": "json",
						"contentType": "json",
						"params": "/${createResourceId}",
						"responseId": "update-birth-response",
						"sourceId": "patient-update-PeterChalmers"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP status is 200(OK).",
						"response": "okay"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned format is JSON.. Warning only as the server may not support the return of response content.",
						"contentType": "json",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP Header Last-Modified is present. Warning only as the server may not support versioning.",
						"headerField": "Last-Modified",
						"operator": "notEmpty",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP Header ETag is present. Warning only as the server may not support versioning.",
						"headerField": "ETag",
						"operator": "notEmpty",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP Header Location is present. Warning only as this is optional but servers are encouraged to return this.",
						"headerField": "Location",
						"operator": "notEmpty",
						"warningOnly": true
					}
				},
				{
					"operation": {
						"type": {
							"system": "http://hl7.org/fhir/testscript-operation-codes",
							"code": "read"
						},
						"resource": "Patient",
						"accept": "json",
						"contentType": "json",
						"params": "/${createResourceId}"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP status is 200(OK).",
						"response": "okay"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned format is JSON.",
						"contentType": "json"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned resource type is Patient.",
						"resource": "Patient"
					}
				},
				{
					"assert": {
						"description": "Validate that the returned resource conforms to the base FHIR Patient profile.",
						"validateProfileId": "patient-profile"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned resource contains the expected updated and retained elements and values. Warning only to provide users with reviewable results.",
						"minimumId": "patient-update-PeterChalmers-min",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Confirm that the resource version is present. Warning only as the server may not support versioning.",
						"operator": "notEmpty",
						"path": "Patient/meta/versionId",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Additional confirmation that birthDate got updated to the expected value.",
						"path": "Patient/birthDate",
						"value": "1975-01-02"
					}
				}
			]
		},
		{
			"id": "Step3-PatientHistory",
			"name": "Step3-PatientHistory",
			"description": "Retrieve the patient's history.",
			"action": [
				{
					"operation": {
						"resource": "Patient",
						"description": "Retrieve the history for a single, known patient using the known identifier.",
						"accept": "json",
						"contentType": "json",
						"params": "/${createResourceId}/_history"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP status is 200(OK).",
						"response": "okay"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned format is JSON.",
						"contentType": "json"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned resource type is Bundle.",
						"resource": "Bundle"
					}
				},
				{
					"assert": {
						"description": "Validate that the returned resource conforms to the base FHIR Bundle profile.",
						"validateProfileId": "bundle-profile"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned Bundle.type is history.",
						"path": "/Bundle/type",
						"value": "history"
					}
				},
				{
					"assert": {
						"description": "Confirm that there is more than one patient history resource returned. Warning only as the server may not support versioning.",
						"operator": "greaterThan",
						"path": "/Bundle/total",
						"value": "1",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Confirm that the Bundle total value matches or is greater than the number of entries in the Bundle. Warning only to provide users with reviewable results.",
						"expression": "Bundle.total.toInteger() >= entry.count()",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Confirm that bundle contains the most recent updated version of the patient. Warning only to provide users with reviewable results.",
						"minimumId": "patient-update-PeterChalmers-min",
						"warningOnly": true
					}
				}
			]
		},
		{
			"id": "Step4-PatientSearch",
			"name": "Step4-PatientSearch",
			"description": "Search for a patient with the name 'James Chalmers'.",
			"action": [
				{
					"operation": {
						"type": {
							"system": "http://hl7.org/fhir/testscript-operation-codes",
							"code": "search"
						},
						"resource": "Patient",
						"description": "Search for the patient James Chalmers. The destination server must support the family and given search parameters.",
						"accept": "json",
						"contentType": "json",
						"params": "?given=${searchGivenName}&family=${searchFamilyName}"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP status is 200(OK).",
						"response": "okay"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned format is JSON.",
						"contentType": "json"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned resource type is Bundle.",
						"resource": "Bundle"
					}
				},
				{
					"assert": {
						"description": "Validate that the returned resource conforms to the base FHIR Bundle profile.",
						"validateProfileId": "bundle-profile"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned Bundle.type is searchset.",
						"path": "/Bundle/type",
						"value": "searchset"
					}
				},
				{
					"assert": {
						"description": "Confirm that there is at least one record returned. There could be other patient records returned.",
						"operator": "greaterThan",
						"path": "/Bundle/total",
						"value": "0"
					}
				},
				{
					"assert": {
						"description": "Confirm that the Bundle total value matches or is greater than the number of entries in the Bundle. Warning only to provide users with reviewable results.",
						"expression": "Bundle.total.toInteger() >= entry.count()",
						"warningOnly": true
					}
				},
				{
					"assert": {
						"description": "Confirm that bundle contains the most recent updated version of the patient. Warning only to provide users with reviewable results.",
						"minimumId": "patient-update-PeterChalmers-min",
						"warningOnly": true
					}
				}
			]
		},
		{
			"id": "Step5-PatientDelete",
			"name": "Step5-PatientDelete",
			"description": "Delete the patient James Chalmers. Execute a subsequent read with an expected response of gone or not found.",
			"action": [
				{
					"operation": {
						"type": {
							"system": "http://hl7.org/fhir/testscript-operation-codes",
							"code": "delete"
						},
						"resource": "Patient",
						"description": "Delete the patient James Chalmers on the destination server in order to leave the server in the same state before this test execution.",
						"accept": "json",
						"contentType": "json",
						"params": "/${createResourceId}"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP status is 200(OK) or 204(No Content).",
						"operator": "in",
						"responseCode": "200,204"
					}
				},
				{
					"operation": {
						"type": {
							"system": "http://hl7.org/fhir/testscript-operation-codes",
							"code": "read"
						},
						"resource": "Patient",
						"description": "Read deleted patient resource with an expected response of gone or not found",
						"accept": "json",
						"contentType": "json",
						"params": "/${createResourceId}"
					}
				},
				{
					"assert": {
						"description": "Confirm that the returned HTTP status is 404(Not Found) or 410(Gone).",
						"operator": "in",
						"responseCode": "404,410"
					}
				}
			]
		}
	]
}